<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold">Lịch sử đấu giá</h1>
        <a href="{{previousPage}}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
    </div>

    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">{{product.product_name}}</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Giá hiện tại:</strong> <span class="text-primary">{{format_currency product.current_price}}</span></p>
                    <p><strong>Giá khởi điểm:</strong> {{format_currency product.start_price}}</p>
                    <p><strong>Bước giá:</strong> {{format_currency product.step_price}}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Tổng lượt đấu giá:</strong> {{product.bid_count}}</p>
                    <p><strong>Ngày bắt đầu:</strong> {{format_datetime (convert_to_local product.created_at)}}</p>
                    <p><strong>Ngày kết thúc:</strong> <span class="text-danger">{{format_endDatetime product.end_time}}</span></p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">Danh sách lượt đấu giá</h5>
        </div>
        <div class="card-body p-0">
            {{#if history.length}}
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>STT</th>
                            <th>Thời điểm</th>
                            <th>Người mua</th>
                            <th>Đánh giá</th>
                            <th class="text-end">Giá đặt</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each history}}
                        <tr>
                            <td>{{@index}}</td>
                            <td>{{format_datetime (convert_to_local created_at)}}</td>
                            <td>
                                {{mask_name bidder_name}}
                                {{#if (eq @index 0)}}
                                <span class="badge bg-success ms-2">Dẫn đầu</span>
                                {{/if}}
                            </td>
                            <td>
                                {{#if (gt total_rating 0)}}
                                <small class="text-muted">
                                    ({{total_rating}}) 
                                    <span class="text-success">{{positive_percentage rating_plus total_rating}}% tích cực</span>
                                </small>
                                {{else}}
                                <small class="text-muted">Chưa có đánh giá</small>
                                {{/if}}
                            </td>
                            <td class="text-end fw-bold">{{format_currency bid_amount}}</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            {{else}}
            <div class="text-center py-5">
                <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc;"></i>
                <p class="text-muted mt-3">Chưa có lượt đấu giá nào</p>
            </div>
            {{/if}}
        </div>
    </div>
</div>